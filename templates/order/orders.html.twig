{% extends 'base.html.twig' %}

{% block title %}Historique des Commandes{% endblock %}

{% block body %}
{% include 'layouts/_flash_message.html.twig'%} 

    <div class="container">
        <h1>Historique des Commandes</h1>
        {% for order in orders %}
            <h2>Commande n° {{order.id}}</h2>
            {% if order.isCompleted == true %}
                <span class ='text-success'>Commande livrée</span>
            {% else %}
                <span class'text-danger'>Commande non livrée</span>
            {% endif %}
            <table class="table">  
            <tr>
                <th>Nom</th>
                <th>Prénom</th>
                <th>Adresse</th>
                <th>Ville</th>
                <th>Téléphone</th> 
            </tr>  
          
            <tr> 
                <td>{{order.lastName}}</td>
                <td>{{order.firstName}}</td>
                <td>{{order.address}}</td>
                <td>{{order.city.name}}</td>
                <td>{{order.phone}}</td>
            </tr>
            </table>

            <h5 class='text-primary'>Corps de la commande</h5>
            <table class='table table-bordered'>
            <tr>
                <th>Nom du produit</th>
                <th>Prix du produit</th>
                <th>Quantité</th>
                <th>Prix total</th>
            </tr>
            {% for product in order.orderProducts %}
            <tr>
                <td>{{product.product.name}}</td>
                <td>{{product.product.price}}</td>
                <td>{{product.quantity}}</td>
                <td>{{product.product.price * product.quantity}} €</td>
            </tr>
            {% endfor %}
            </table>
            <h5>Frais de livraison : {{order.city.shippingCost}} €</h5>
            <h5 class="mb-3">Total à payer : {{order.totalPrice}} €</h5>
            {% if order.isCompleted != true  %}
                <a href="{{ path ('app_orders_is-completed-update', {'id':order.id})}}" class='btn btn-outline-primary mb-5 col-2 m-1g-1'>Marquer comme livrée</a>    
            {% endif %}
            <a onclick="return confirm ('Voulez-vous vraiment supprimer cette commande ?')" href="{{ path ('app_orders_remove', {'id':order.id})}}" class='btn btn-outline-danger mb-5 col-2 m-1g-1'>Supprimer la commande</a>
            <a href="{{ path ('app_bill',{'id':order.id})}}" class='btn btn-outline-success mb-5 col-2 m-1g-1'>Imprimer la facture</a>
        {% endfor %}
        {{ knp_pagination_render(orders, 'layouts/_pagination_template.html.twig') }}
    </div>

{% endblock %}